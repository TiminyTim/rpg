#pragma once
#include <string>
#include <stdio.h>
// Rpg Headers
#include "point.cc"
#include "class.cc"
#include "graphics.h"
//#include "combat.cc"
using namespace std;

bool solved1;
bool solved2;
bool solved3;
bool solved4;
bool solved5;
bool solved6;
unsigned int i = 0;
unsigned int j = 0;

int initiate_combat(vector<shared_ptr<Actor>>& cast, int direction);
vector<string> game_map = {
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"............................................................................................................................................###............................................................................",
	".........................................................................................................................................####K###..........................................................................",
	"......................................................................................................................................####   E  #..........................................................................",
	".........................................................................................########################.....................#         #..........................................................................",
	".........................................................................................#bbb K                b#.....................#        ##..........................................................................",
	".........................................................................................# b                   b#.....................#   b    #...........................................................................",
	".........................................................................................## ####GLG##########GEG#.....................#### #####...........................................................................",
	".........................................................................................#         #.#    G     #........................# #...............................................................................",
	".........................................................................................#       ###.#        ###........................# #...............................................................................",
	".........................................................................................#b      b #.#    G     #.......................#fKf#...................############...............................................",
	".........................................................................................######## ##.############.......................# E #........##########.#          #...............................................",
	"................................................................................................# #.....................................#   ##########        #.#  #GGGGG# #...............................................",
	"................................................................................................# #.........###.........................#               ###   #.#  Gf  bbG ####............................................",
	"................................................................................................# #.........#C#..########################   #############.#   ###  G    bG    L............................................",
	"..............................................................................................### #.........# ####                          #.............#    L   L  w  G ####............................................",
	"..............................................................................................#   #.........#   ## #######L##################.............#   ###  G     G #...............................................",
	"...........................................................................................#### ###...####### # b   #...#   #.............................#   #.#..#GGGLG###...............................................",
	"...........................................................................................#   K#.....# b    b ######...#   #.............................#   #.####       #...............................................",
	"...........................................................................................#b   #######b b b     #......#   #.............................# E #....#b   p  #...............................................",
	".................................................................#######........#########..####    P    ######GLG#.....##   ##............................#fKf#....#########...............................................",
	".................................................................#     #...####.#    aab#.....###########....#  b#....## P   ##............................###.............................................................",
	".................................................................#   b #####ba###      b#....................##C##...##   A   ##...........................................................................................",
	".................................................................# 1     C    ## b   V  #.....................###....#  f   f  ######......................................................................................",
	"...............................................................### 1 b #####     b#     #............................#             bb......................................................................................",
	"...............................................................#       #...#  ## b b    #.......................###### z     Z ######......................................................................................",
	"...............................................................# #######...#  ##a  b    #########################              #...........................................................................................",
	"...............................................................#1#.........#  ## b#      L  L  Y             k    ####  f   f  #...........................................................................................",
	"...............................................................# #.#######.#~ ## b      ######bb   b###############..#    i    #...........................................................................................",
	"...............................................................#!#.#    C#.#   P#     bb#....########................###  K    #...........................................................................................",
	"...............................................................# ###L#C P#.#### b  a bs #......................#####...##      #...........................................................................................",
	"...............................................................#  l  #####....###.#######........########......#KC  #####a a####...........................................................................................",
	"...............................................................##### #........................####o     ##.....#  xbb         #............................................................................................",
	"...................................................................#P###...........##########.#   b bb   #.....#  a ######### #............................................................................................",
	"...................................................................# a #.....####..#   4  4 #.# ###5  ab #.....## ###.......# #............................................................................................",
	".................................................................###b2 #.....# 3#..# 4  4 b #.# #######5 #......# #...#####.# #............................................................................................",
	".................................................................# b   #.....# 3#..# b # a###.# #######5 #.....## ##### b #.# #............................................................................................",
	".................................................................# 2 b2#.....#a #..# b    #...# ### # a5 #.....#   b   ba #.# #............................................................................................",
	".................................................................#     #....##  #.##H###b #.### #O   5b  #.....####### b  #.# #............................................................................................",
	".................................................................### ###....# b #.#  #.#  #.#   # ########...........###a #.#X#............................................................................................",
	"...................................................................#2#......#   #.# ##.## ### ###5#....................#  ### #............................................................................................",
	"...................................................................# #.#.####abb#.# #...#4   &#.# ########.............# b   e#............................................................................................",
	"...................................................................#?#.#       3#.#h#...#######.#     %  ##............##bav ##............................................................................................",
	".................................................................### ### ##### ##.# #...........########  #.............#   a#.............................................................................................",
	".................................................................#  ba   #...# #..# #..................## ##............######.............................................................................................",
	"..............................................................#### a a ab#...# #### #..#######..........#  #...............................................................................................................",
	"...............................................................         b#...#3    ^#..#     ####...#####ar############....................................................................................................",
	"..............................................................# ##########...########..#  p     #...#  L       R  C  t#....................................................................................................",
	"..............................................................#J###....................#        #...# ############### #....................................................................................................",
	"..............................................................#   #....................##########...# #.............# #....................................................................................................",
	"..............................................................### ####..............................# #.............# #....................................................................................................",
	"...............................................................##    #...###########.......########## #.............# #....................................................................................................",
	"...............................................................#q b  #...#         #.......#          #.............# #....................................................................................................",
	"...............................................................### bq#...# ####### #.......# ##########..#######....# #....................................................................................................",
	"...............................................................#q##b #...# #.....# ######### #...........#aCCaa#....#T#....................................................................................................",
	"...............................................................# # q ###.# #...###      g    #.......##### b  a#....# #....................................................................................................",
	"...............................................................#b Qbbq #.# #..##b       g K  #.......#CaCC   CC#....#C#....................................................................................................",
	"...............................................................#   q   #.# #..#a   P   #########.....#C     ####....# #....................................................................................................",
	"...............................................................## ######.# #..#              aa#.....#CCC   #.......#C#....................................................................................................",
	"................................................................# #......# #..#               a#.....#C   CC#.......# #....................................................................................................",
	"................................................................# ######## #..#b               #.....#   CCb####...## ##...................................................................................................",
	"................................................................#  q    *  #..#   b#GGGG####ggg#.....# C  Cbba##...# E #...................................................................................................",
	"................................................................############..#  bb#    #..#   #.....#CC   CCC#....#   #...................................................................................................",
	"..............................................................................######  p #..#s C#.....#bCaa CCC#....#cwc#...................................................................................................",
	"...................................................................................######..#####.....##########....#####...................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
	"...........................................................................................................................................................................................................................",
};
enum direction {UP, DOWN, LEFT, RIGHT};
bool checkTile(vector <shared_ptr<Actor>>& cast, int direction) { //Returns false if you cannot pass, returns 1 if the block is pass-able. Checks value on other side of block
	shared_ptr<Hero> h = static_pointer_cast<Hero>(cast.at(0)); 

	int x = h->p->x;
	int y = h->p->y;

	if (direction == UP) { y--; }
	if (direction == DOWN) { y++; }
	if (direction == LEFT) { x--; }
	if (direction == RIGHT) { x++; }

	int diffx = h->p->x - x;
	int diffy = h->p->y - y;

	if (game_map.at(y).at(x) == '#' || game_map.at(y).at(x) == 'a' || game_map.at(y).at(x) == 'G') return 0;
	else if (game_map.at(y).at(x) == '!' || game_map.at(y).at(x) == '?' || game_map.at(y).at(x) == '^' || game_map.at(y).at(x) == '&' || game_map.at(y).at(x) == '%') return 0;

	//Check for box
	else if (game_map.at(y).at(x) == 'b') {
		//Check for empty space
		if (game_map.at(y - diffy).at(x - diffx) == ' ') {
			game_map.at(y - diffy).at(x - diffx) = 'b';
			//game_map.at(y).at(x) = ' ';
			game_map.at(y).at(x) = ' ';
			return 1;
		}

		//Check for Pressure plate
		if (game_map.at(y - diffy).at(x - diffx) == '1') {
			game_map.at(y - diffy).at(x - diffx) = '6';
			game_map.at(y).at(x) = ' ';
			game_map.at(y).at(x) = ' ';
			return 1;
		}
		if (game_map.at(y - diffy).at(x - diffx) == '2') {
			game_map.at(y - diffy).at(x - diffx) = '7';
			game_map.at(y).at(x) = ' ';
			game_map.at(y).at(x) = ' ';
			return 1;
		}
		if (game_map.at(y - diffy).at(x - diffx) == '3') {
			game_map.at(y - diffy).at(x - diffx) = '8';
			game_map.at(y).at(x) = ' ';
			game_map.at(y).at(x) = ' ';
			return 1;
		}
		if (game_map.at(y - diffy).at(x - diffx) == '4') {
			game_map.at(y - diffy).at(x - diffx) = '9';
			game_map.at(y).at(x) = ' ';
			game_map.at(y).at(x) = ' ';
			return 1;
		}
		if (game_map.at(y - diffy).at(x - diffx) == '5') {
			game_map.at(y - diffy).at(x - diffx) = '0';
			game_map.at(y).at(x) = ' ';
			game_map.at(y).at(x) = ' ';
			return 1;
		}
		else return 0;
	}

	//Check for DOWN Pressure plate
	else if (game_map.at(y).at(x) == '6') {
		if (game_map.at(y - diffy).at(x - diffx) == ' ' || game_map.at(y - diffy).at(x - diffx) == '6') {
			game_map.at(y - diffy).at(x - diffx) = 'b';
			game_map.at(y).at(x) = '1';
			return 1;
		}
		if (game_map.at(y - diffy).at(x - diffx) == '1') {
			game_map.at(y - diffy).at(x - diffx) = '6';
			game_map.at(y).at(x) = '1';
			return 1;
		}
		if (game_map.at(y - diffy).at(x - diffx) == 'b') {
			return 0;
		}
	}

	else if (game_map.at(y).at(x) == '7') {
		if (game_map.at(y - diffy).at(x - diffx) == ' ') {
			game_map.at(y - diffy).at(x - diffx) = 'b';
			game_map.at(y).at(x) = '2';
			return 1;
		}
		if (game_map.at(y - diffy).at(x - diffx) == '2') {
			game_map.at(y - diffy).at(x - diffx) = '7';
			game_map.at(y).at(x) = '2';
			return 1;
		}
		if (game_map.at(y - diffy).at(x - diffx) == 'b') {
			return 0;
		}
	}

	else if (game_map.at(y).at(x) == '8') {
		if (game_map.at(y - diffy).at(x - diffx) == ' ') {
			game_map.at(y - diffy).at(x - diffx) = 'b';
			game_map.at(y).at(x) = '2';
			return 1;
		}
		if (game_map.at(y - diffy).at(x - diffx) == '3') {
			game_map.at(y - diffy).at(x - diffx) = '8';
			game_map.at(y).at(x) = '3';
			return 1;
		}
		if (game_map.at(y - diffy).at(x - diffx) == 'b') {
			return 0;
		}
	}

	else if (game_map.at(y).at(x) == '9') {
		if (game_map.at(y - diffy).at(x - diffx) == ' ') {
			game_map.at(y - diffy).at(x - diffx) = 'b';
			game_map.at(y).at(x) = '4';
			return 1;
		}
		if (game_map.at(y - diffy).at(x - diffx) == '4') {
			game_map.at(y - diffy).at(x - diffx) = '9';
			game_map.at(y).at(x) = '4';
			return 1;
		}
		if (game_map.at(y - diffy).at(x - diffx) == 'b') {
			return 0;
		}
	}

	else if (game_map.at(y).at(x) == '0') {
		if (game_map.at(y - diffy).at(x - diffx) == ' ') {
			game_map.at(y - diffy).at(x - diffx) = 'b';
			game_map.at(y).at(x) = '5';
			return 1;
		}
		if (game_map.at(y - diffy).at(x - diffx) == '5') {
			game_map.at(y - diffy).at(x - diffx) = '0';
			game_map.at(y).at(x) = '5';
			return 1;
		}
		if (game_map.at(y - diffy).at(x - diffx) == 'b') {
			return 0;
		}
	}

	else if (game_map.at(y).at(x) == '0') {
		if (game_map.at(y - diffy).at(x - diffx) == ' ') {
			game_map.at(y - diffy).at(x - diffx) = 'b';
			game_map.at(y).at(x) = '5';
			return 1;
		}
		if (game_map.at(y - diffy).at(x - diffx) == '5') {
			game_map.at(y - diffy).at(x - diffx) = '0';
			game_map.at(y).at(x) = '5';
			return 1;
		}
		if (game_map.at(y - diffy).at(x - diffx) == 'b') {
			return 0;
		}
	}
	else if (game_map.at(y).at(x) == 'S') {
		game_map.at(y).at(x) = 's';
		draw_game_map(cast);
		return 0;
	}
	else if (game_map.at(y).at(x) == 's') {
		game_map.at(y).at(x) = 'S';
		draw_game_map(cast);
		return 0;
	}
	else if (game_map.at(y).at(x) == 'C') {
		game_map.at(y).at(x) = ' ';
		static_pointer_cast<Hero> (h)->num_cheese++;
		return 1;
	}
	else if (game_map.at(y).at(x) == 'P') {
		game_map.at(y).at(x) = ' ';
		static_pointer_cast<Hero>(h)->num_potions++;
		return 1;
	}
	else if (game_map.at(y).at(x) == 'K') {
		game_map.at(y).at(x) = ' ';
		static_pointer_cast<Hero>(h)->num_keys++;
		return 1;
	}
	else if (game_map.at(y).at(x) == 'L') {
		if (static_pointer_cast<Hero>(h)->num_keys > 0) {
			game_map.at(y).at(x) = ' ';
			static_pointer_cast<Hero>(h)->num_keys--;
			return 1;
		} else return 0;
	}
	else if (game_map.at(y).at(x) == 'E') {
		return initiate_combat (cast, direction); //Enters combat with a character, and the tile he's pointing at.
	}
	//DIALOGUE
	else if (game_map.at(y).at(x) == 'Z') {
		game_map.at(y).at(x) = ' ';
		movecursor(j, 2 * game_map.at(0).size());
		cout << "You wake up with a cough and a sore throat.";
		return 1;
	}

	else if (game_map.at(y).at(x) == 'z') {
		game_map.at(y).at(x) = ' ';
		movecursor(j, 2 * game_map.at(0).size());
		cout << "You've never seen this place before. This room is cold and wet.";
		return 1;
	}

	else if (game_map.at(y).at(x) == 'Y') {
		game_map.at(y).at(x) = ' ';
		movecursor(j, 2 * game_map.at(0).size());
		cout << "In front of you is a large, petrified oak door. It has a rusted keyhole.";
		return 1;
	}

	else if (game_map.at(y).at(x) == 'y') {
		game_map.at(y).at(x) = ' ';
		movecursor(j, 2 * game_map.at(0).size());
		cout << "The room is humid, and steamy. Where is the steam coming from?";
		return 1;
	}

	else if (game_map.at(y).at(x) == 'X') {
		game_map.at(y).at(x) = ' ';
		movecursor(j, 2 * game_map.at(0).size());
		cout << "As you make your way through the cobwebs, the tunnel darkens.";
		return 1;
	}

	else if (game_map.at(y).at(x) == 'x') {
		game_map.at(y).at(x) = ' ';
		movecursor(j, 2 * game_map.at(0).size());
		cout << "Is there... light at the end of this tunnel?";
		return 1;
	}

	else if (game_map.at(y).at(x) == 'e') {
		game_map.at(y).at(x) = ' ';
		movecursor(j, 2 * game_map.at(0).size());
		cout << "You come into a room filled with heavy, unmoveable barrels and boxes.";
		return 1;
	}

	else if (game_map.at(y).at(x) == 'A') {
		game_map.at(y).at(x) = ' ';
		cout << "The torches are your only source of warmth in this empty dungeon. They warm your cold heart.";
		return 1;
	}

	else if (game_map.at(y).at(x) == 'v') {
		game_map.at(y).at(x) = ' ';
		cout << "These crates seem light enough. Maybe you can move them out of the way?";
		return 1;
	}

	else if (game_map.at(y).at(x) == 'i') {
		game_map.at(y).at(x) = ' ';
		cout << "You see an old rusty key. Could this be used for something?";
		return 1;
	}

	else if (game_map.at(y).at(x) == 'k') {
		game_map.at(y).at(x) = ' ';
		cout << "As you walk down the tunnel, you run your hand down the rugged, blue brick walls.";
		return 1;
	}

	else if (game_map.at(y).at(x) == '~') {
		game_map.at(y).at(x) = ' ';
		cout << "You see a vial of mysterious liquid. Should you drink it?";
		return 1;
	}

	else if (game_map.at(y).at(x) == 'l') {
		game_map.at(y).at(x) = ' ';
		cout << "You sneeze. The sneeze echoes through the corridor.";
		return 1;
	}

	else if (game_map.at(y).at(x) == 'h') {
		game_map.at(y).at(x) = ' ';
		cout << "As you walk down the tunnel, your footsteps become quieter.";
		return 1;
	}

	else if (game_map.at(y).at(x) == 'o') {
		game_map.at(y).at(x) = ' ';
		cout << "Bones litter the floor, and blood is splattered all over the walls.";
		return 1;
	}

	else if (game_map.at(y).at(x) == 'O') {
		game_map.at(y).at(x) = ' ';
		cout << "You see someone's skeleton. Someone has died here.";
		return 1;
	}

	else if (game_map.at(y).at(x) == 'r') {
		game_map.at(y).at(x) = ' ';
		cout << "As you walk down the corridor, your sense of smell and taste is returning!";
		return 1;
	}

	else if (game_map.at(y).at(x) == 'R') {
		game_map.at(y).at(x) = ' ';
		cout << "The air tastes like salty coins, and a repungent odor of onions and cheese lingers in the air.";
		return 1;
	}

	else if (game_map.at(y).at(x) == 't') {
		game_map.at(y).at(x) = ' ';
		cout << "As you turn the corner, you see a giant ogre at the end of the hallway!";
		return 1;
	}

	else if (game_map.at(y).at(x) == 'T') {
		game_map.at(y).at(x) = ' ';
		cout << "His name is Carl. Carl burps and farts at the same. He is wielding a large club.";
		return 1;
	}

	else if (game_map.at(y).at(x) == 'J') {
		game_map.at(y).at(x) = ' ';
		cout << "Due to a lack of time and brain power, anything past this hallway is probably broken.";
		return 1;
	}
	else return 1;
	return 1;
}
